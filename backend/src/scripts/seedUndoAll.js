const { Sequelize } = require('sequelize');
const path = require('path');
const config = require('../config/config.js');

const env = process.env.NODE_ENV || 'development';
const dbConfig = config[env];

const sequelize = new Sequelize(
  dbConfig.database,
  dbConfig.username,
  dbConfig.password,
  {
    host: dbConfig.host,
    dialect: dbConfig.dialect,
    logging: console.log
  }
);

async function undoAllSeeders() {
  try {
    console.log('üóëÔ∏è  Suppression de toutes les donn√©es des seeders...\n');

    const queryInterface = sequelize.getQueryInterface();

    // Liste des tables dans l'ordre inverse de d√©pendance
    const tables = [
      'posts',
      'topics',
      'sections',
      'categories',
      'characters',
      'users',
      'clans',
      'factions',
      'ethnies'
    ];

    for (const table of tables) {
      console.log(`üóëÔ∏è  Vidage de la table: ${table}`);
      await queryInterface.bulkDelete(table, null, {});
      console.log(`‚úÖ ${table} - Vid√©e\n`);
    }

    console.log('‚ú® Toutes les donn√©es des seeders ont √©t√© supprim√©es!');
    process.exit(0);
  } catch (error) {
    console.error('‚ùå Erreur lors de la suppression des donn√©es:', error);
    process.exit(1);
  } finally {
    await sequelize.close();
  }
}

undoAllSeeders();
