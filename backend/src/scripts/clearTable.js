const { sequelize } = require('../config/database');

/**
 * Script pour vider une table sp√©cifique
 * Usage: node src/scripts/clearTable.js <table_name>
 * Exemple: node src/scripts/clearTable.js users
 */

async function clearTable() {
  const tableName = process.argv[2];

  if (!tableName) {
    console.error('‚ùå Erreur: Vous devez sp√©cifier le nom de la table √† vider.');
    console.log('Usage: npm run db:clear <table_name>');
    console.log('Exemple: npm run db:clear users');
    process.exit(1);
  }

  try {
    console.log(`üîÑ V√©rification de l'existence de la table "${tableName}"...`);

    // V√©rifier si la table existe
    const [tables] = await sequelize.query(
      "SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = ?",
      { replacements: [tableName] }
    );

    if (tables.length === 0) {
      console.error(`‚ùå Erreur: La table "${tableName}" n'existe pas dans la base de donn√©es.`);
      process.exit(1);
    }

    console.log(`üóëÔ∏è  Vidage de la table "${tableName}"...`);

    // D√©sactiver temporairement les contraintes de cl√©s √©trang√®res
    await sequelize.query('SET FOREIGN_KEY_CHECKS = 0');

    // Vider la table
    await sequelize.query(`TRUNCATE TABLE ${tableName}`);

    // R√©activer les contraintes de cl√©s √©trang√®res
    await sequelize.query('SET FOREIGN_KEY_CHECKS = 1');

    console.log(`‚úÖ Table "${tableName}" vid√©e avec succ√®s!`);

  } catch (error) {
    console.error('‚ùå Erreur lors du vidage de la table:', error.message);
    process.exit(1);
  } finally {
    await sequelize.close();
  }
}

clearTable();
