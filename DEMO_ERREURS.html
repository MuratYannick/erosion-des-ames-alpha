<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Démo Gestion des Erreurs - Érosion des Âmes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(to bottom, #1a1a1a, #0a0a0a);
            color: #e0e0e0;
        }
        h1 {
            color: #f97316;
            text-align: center;
            margin-bottom: 40px;
        }
        h2 {
            color: #fb923c;
            border-bottom: 2px solid #f97316;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background: #2a2a2a;
            border: 2px solid #444;
            border-radius: 8px;
            padding: 20px;
        }
        .card.inline {
            border-color: #f97316;
        }
        .card.redirect {
            border-color: #dc2626;
        }
        .card h3 {
            margin-top: 0;
            color: #fbbf24;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .badge.inline {
            background: #f97316;
            color: white;
        }
        .badge.redirect {
            background: #dc2626;
            color: white;
        }
        .example {
            background: #1a1a1a;
            border-left: 3px solid #f97316;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.9em;
        }
        .code {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            overflow-x: auto;
        }
        code {
            color: #a78bfa;
        }
        .success {
            color: #10b981;
        }
        .error {
            color: #ef4444;
        }
        .warning {
            color: #f59e0b;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #444;
        }
        th {
            background: #f97316;
            color: white;
        }
        tr:nth-child(even) {
            background: #2a2a2a;
        }
        .visual-demo {
            background: #1a1a1a;
            border: 2px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .form-error {
            background: #7f1d1d;
            border: 2px solid #991b1b;
            color: #fca5a5;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .page-error {
            background: #dc2626;
            color: white;
            padding: 40px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.5em;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>🎮 Érosion des Âmes - Gestion des Erreurs</h1>

    <div style="text-align: center; margin-bottom: 40px; padding: 20px; background: #2a2a2a; border-radius: 8px;">
        <p style="font-size: 1.2em; color: #fbbf24;">
            Toutes les erreurs HTTP (4xx, 5xx) et réseau sont maintenant gérées !
        </p>
        <p class="success">✅ Erreurs de formulaire → Messages inline</p>
        <p class="error">✅ Erreurs système → Pages dédiées</p>
    </div>

    <h2>📝 Dans les formulaires (Login & Register)</h2>

    <div class="grid">
        <div class="card inline">
            <span class="badge inline">📝 MESSAGE INLINE</span>
            <h3>400 - Bad Request</h3>
            <p><strong>Cas :</strong> Validation</p>
            <div class="example">
                • Format email invalide<br>
                • Mot de passe trop court<br>
                • Champs manquants
            </div>
        </div>

        <div class="card inline">
            <span class="badge inline">📝 MESSAGE INLINE</span>
            <h3>401 - Unauthorized</h3>
            <p><strong>Cas :</strong> Authentification</p>
            <div class="example">
                • Email inexistant<br>
                • Mot de passe incorrect<br>
                • Identifiants invalides
            </div>
        </div>

        <div class="card inline">
            <span class="badge inline">📝 MESSAGE INLINE</span>
            <h3>409 - Conflict</h3>
            <p><strong>Cas :</strong> Conflit</p>
            <div class="example">
                • Email déjà utilisé<br>
                • Username déjà pris<br>
                • Ressource en conflit
            </div>
        </div>
    </div>

    <h2>🔀 Erreurs qui redirigent vers une page</h2>

    <div class="grid">
        <div class="card redirect">
            <span class="badge redirect">🔀 REDIRECTION</span>
            <h3>500 - Server Error</h3>
            <p><strong>Page :</strong> /error/500</p>
            <div class="example">
                • Bug backend<br>
                • Erreur SQL<br>
                • Exception non gérée
            </div>
        </div>

        <div class="card redirect">
            <span class="badge redirect">🔀 REDIRECTION</span>
            <h3>503 - Unavailable</h3>
            <p><strong>Page :</strong> /error/503</p>
            <div class="example">
                • Serveur en maintenance<br>
                • Base de données down<br>
                • Surcharge serveur
            </div>
        </div>

        <div class="card redirect">
            <span class="badge redirect">🔀 REDIRECTION</span>
            <h3>Network Error</h3>
            <p><strong>Page :</strong> /error/network</p>
            <div class="example">
                • Backend arrêté<br>
                • Perte de connexion<br>
                • Timeout
            </div>
        </div>
    </div>

    <h2>📊 Tableau récapitulatif</h2>

    <table>
        <thead>
            <tr>
                <th>Code HTTP</th>
                <th>Context</th>
                <th>Comportement</th>
                <th>Exemples</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>400</code></td>
                <td>Formulaire</td>
                <td><span class="success">📝 Message inline</span></td>
                <td>Email invalide, champs vides</td>
            </tr>
            <tr>
                <td><code>401</code></td>
                <td>Formulaire</td>
                <td><span class="success">📝 Message inline</span></td>
                <td>Mauvais email/password</td>
            </tr>
            <tr>
                <td><code>409</code></td>
                <td>Formulaire</td>
                <td><span class="success">📝 Message inline</span></td>
                <td>Email déjà utilisé</td>
            </tr>
            <tr>
                <td><code>401</code></td>
                <td>Autre</td>
                <td><span class="error">🔀 /error/401</span></td>
                <td>Token expiré</td>
            </tr>
            <tr>
                <td><code>403</code></td>
                <td>Tous</td>
                <td><span class="error">🔀 /error/403</span></td>
                <td>Accès refusé</td>
            </tr>
            <tr>
                <td><code>404</code></td>
                <td>Tous</td>
                <td><span class="error">🔀 /error/404</span></td>
                <td>Route inexistante</td>
            </tr>
            <tr>
                <td><code>500</code></td>
                <td>Tous</td>
                <td><span class="error">🔀 /error/500</span></td>
                <td>Bug serveur</td>
            </tr>
            <tr>
                <td><code>503</code></td>
                <td>Tous</td>
                <td><span class="error">🔀 /error/503</span></td>
                <td>Service indisponible</td>
            </tr>
            <tr>
                <td><code>Network</code></td>
                <td>Tous</td>
                <td><span class="error">🔀 /error/network</span></td>
                <td>Backend arrêté</td>
            </tr>
        </tbody>
    </table>

    <h2>🎨 Démonstration visuelle</h2>

    <div class="visual-demo">
        <h3>Message dans le formulaire (401)</h3>
        <div class="form-error">
            ❌ Email ou mot de passe incorrect
        </div>
        <p style="color: #a0a0a0; font-size: 0.9em;">
            → L'utilisateur reste sur la page et peut corriger immédiatement
        </p>
    </div>

    <div class="visual-demo">
        <h3>Page d'erreur dédiée (500)</h3>
        <div class="page-error">
            500 - Erreur Interne
            <p style="font-size: 0.6em; margin-top: 20px;">
                Une erreur s'est produite sur nos serveurs...
            </p>
        </div>
        <p style="color: #a0a0a0; font-size: 0.9em;">
            → L'utilisateur est redirigé vers une page d'erreur informative
        </p>
    </div>

    <h2>💻 Implémentation technique</h2>

    <div class="code">
        <code>
// Dans Login.jsx et Register.jsx<br>
try {<br>
&nbsp;&nbsp;const response = await authService.login(email, password);<br>
} catch (err) {<br>
&nbsp;&nbsp;<span class="warning">// skipValidationErrors: true pour les formulaires</span><br>
&nbsp;&nbsp;const wasRedirected = handleError(err, navigate, { <br>
&nbsp;&nbsp;&nbsp;&nbsp;skipValidationErrors: true <br>
&nbsp;&nbsp;});<br>
<br>
&nbsp;&nbsp;<span class="success">// Si pas redirigé, afficher dans le formulaire</span><br>
&nbsp;&nbsp;if (!wasRedirected) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;setError(err.message);<br>
&nbsp;&nbsp;}<br>
}
        </code>
    </div>

    <h2>🧪 Tests effectués</h2>

    <div class="grid">
        <div class="card">
            <h3>✅ Test 401</h3>
            <div class="code" style="font-size: 0.8em;">
                <code>
curl -X POST http://localhost:3000/api/auth/login<br>
&nbsp;&nbsp;-d '{"email":"admin@...","password":"wrong"}'<br>
<br>
<span class="success">→ HTTP 401</span><br>
<span class="success">→ Message dans formulaire</span>
                </code>
            </div>
        </div>

        <div class="card">
            <h3>✅ Test 409</h3>
            <div class="code" style="font-size: 0.8em;">
                <code>
curl -X POST http://localhost:3000/api/auth/register<br>
&nbsp;&nbsp;-d '{"username":"admin",...}'<br>
<br>
<span class="success">→ HTTP 409</span><br>
<span class="success">→ Message dans formulaire</span>
                </code>
            </div>
        </div>

        <div class="card">
            <h3>✅ Test 404</h3>
            <div class="code" style="font-size: 0.8em;">
                <code>
curl http://localhost:3000/api/nonexistent<br>
<br>
<span class="success">→ HTTP 404</span><br>
<span class="success">→ Redirect /error/404</span>
                </code>
            </div>
        </div>
    </div>

    <h2>📚 Documentation créée</h2>

    <ul style="font-size: 1.1em; line-height: 2;">
        <li>📄 <code>GESTION_ERREURS_FORMULAIRES.md</code> - Guide détaillé</li>
        <li>📄 <code>VERIFICATION_GESTION_ERREURS.md</code> - Rapport technique</li>
        <li>📄 <code>SYNTHESE_GESTION_ERREURS.md</code> - Synthèse complète</li>
        <li>📄 <code>test-errors.md</code> - Guide de tests</li>
        <li>📄 <code>DEMO_ERREURS.html</code> - Cette page</li>
    </ul>

    <div style="text-align: center; margin-top: 60px; padding: 30px; background: linear-gradient(135deg, #f97316, #dc2626); border-radius: 8px;">
        <h2 style="color: white; margin: 0;">🎉 Gestion des erreurs complète et robuste !</h2>
        <p style="color: white; margin-top: 10px;">
            Tous les codes HTTP, erreurs réseau et erreurs React sont maintenant gérés
        </p>
    </div>
</body>
</html>
